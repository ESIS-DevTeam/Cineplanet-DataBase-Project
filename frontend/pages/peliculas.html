<!DOCTYPE html>

<!---hola xd no sabia como hacer un comentario en HTML-->
<html lang="es" >
    <head>
        <meta charset="utf-8">
        <meta name="author" content="Willo">
        <meta name="description" content="Esta pagina replica el inicio de la pagina de Cineplanet">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Pel√≠culas</title>
        <link rel="shortcut icon" href="icono-cine.ico" type="image/x-icon">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
        <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;700&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;700&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="../styles/peliculas.css">
        <link rel="stylesheet" href="../styles/header2.css">
    </head>

    <body>
        <header>
            <div class="header-group">
                <a href="../../index.html" target="_self">
                    <img src="../images/items/logo3.png" alt="Cineplanet Logo" class="logo-cineplanet" height="40">
                </a>
                <nav>
                    <ul class="menu-nav">
                        <li><a href="peliculas.html" class="active" target="_self">Pel√≠culas</a></li>
                        <li><a href="cines.html" target="_self">Cines</a></li>
                        <li><a href="promociones.html" target="_self">Promociones</a></li>
                        <li><a href="socio.html" target="_self">Socio</a></li>
                        <li><a href="dulceriaLading.html" target="_self">Dulcer√≠a</a></li>
                        <li><a href="corporativo.html" target="_self">Corporativo</a></li>
                        <li><a href="blog.html" target="_blank">Blog</a></li>
                    </ul>
                    <div class="nav-actions">
                        <button class="socio-btn" aria-label="socio">
                            <i class="fa-regular fa-user"></i>
                        </button>
                        <button class="buscar-btn" aria-label="Buscar">
                            <i class="fa-solid fa-magnifying-glass"></i>
                        </button>
                        <button class="ayuda-btn" aria-label="ayuda">
                            <i class="fa-regular fa-circle-question"></i>
                        </button>
                    </div>
                </nav>
            </div>
        </header>
        <main>
            <div class="contenedor-central">
                <div style="display:flex; align-items:flex-start; gap:0; width:100%;">
                    <div style="width:100%;">
                        <div id="titulo-peliculas">
                            <h1>Pel√≠culas</h1>
                            <div id="peliculas-tabs">
                                <button id="tab-cartelera">En cartelera</button>
                                <button id="tab-preventa" class="inactive">Preventa</button>
                            </div>
                        </div>
                        <hr class="linea-divisoria">
                    </div>
                </div>
                <div id="contenedor-principal">
                    <aside>
                        <div class="filtros-header" style="padding:32px 24px 16px 24px;">
                            <i class="fas fa-sliders-h"></i>
                            Filtrar Por:
                        </div>
                        <form id="filtros-peliculas" style="padding:0 24px;">
                            <details id="detalleCiudades">
                                <summary>Ciudad</summary>
                                <div id="contenedorCiudades"></div>
                            </details>
                            <details id="detalleCines">
                                <summary>Cine</summary>
                                <div id="contenedorCines"></div>
                            </details>
                            <details id="fecha">
                                <summary>D√≠a</summary>
                                <div id="filtro-fecha"></div>  
                            </details>
                            <details id="detalleGeneros">
                                <summary>G√©nero</summary>
                                <div id="contenedorGeneros"></div>
                            </details>
                            <details id="detalleIdiomas">
                                <summary>Idioma</summary>
                                <div id="contenedorIdiomas"></div>
                            </details>
                            <details id="detalleFormato">
                                <summary>Formato</summary>
                                <div id="contenedorFormato"></div>
                            </details>
                            <details id="detalleCensura">
                                <summary>Censura</summary>
                                <div id="contenedorCensura"></div>
                            </details>
                        </form>
                    </aside>
                    <section>
                        <div id="contenedorPeliculas"></div>
                    </section>
                </div>
            </div>
        </main>
        <div id="socio-info" style="text-align:right; margin:10px;"></div>
        <!-- Ventana flotante socio -->
        <div id="socio-popup" style="display:none; position:fixed; top:70px; left:30px; background:#fff; border:1px solid #ccc; box-shadow:0 2px 8px #0002; z-index:1000; width:auto; min-width:0; max-width:260px; padding:16px; border-radius:8px;">
            <div id="socio-popup-content"></div>
        </div>
        <script type="module" src="../js/mostrarPeliculas.js"></script>
        <script >
            let socioData = null;
            fetch('../../backend/auth/checkSession.php')
                .then(res => res.json())
                .then(data => {
                    socioData = data.socio || null;
                    if (data.loggedIn && socioData) {
                        document.getElementById('socio-info').innerHTML =
                            'üë§ Socio: ' + socioData.nombre +
                            ' <button onclick="logout()">Cerrar sesi√≥n</button>';
                    } else {
                        document.getElementById('socio-info').innerHTML =
                            `<a href="login.html?redirect=peliculas.html">Iniciar sesi√≥n</a>`;
                    }
                });

            function logout() {
                fetch('../../backend/auth/logout.php')
                    .then(() => window.location.reload());
            }

            // Ventana flotante socio
            const socioBtn = document.querySelector('.socio-btn');
            const popup = document.getElementById('socio-popup');
            const popupContent = document.getElementById('socio-popup-content');

            // Asegura que el evento funcione tambi√©n si se hace click en el √≠cono dentro del bot√≥n
            socioBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                if (popup.style.display === 'block') {
                    popup.style.display = 'none';
                    return;
                }
                if (socioData) {
                    popupContent.innerHTML = `
                        <div style="font-weight:bold; margin-bottom:8px;">${socioData.nombre}</div>
                        <button onclick="window.location.href='misBeneficos.html'">Mis beneficios</button><br>
                        <button onclick="window.location.href='misCompras.html'">Mis compras</button><br>
                        <button onclick="window.location.href='misDatos.html'">Mis datos</button><br>
                        <button onclick="logout()">Cerrar sesi√≥n</button>
                    `;
                } else {
                    popupContent.innerHTML = `
                        <button onclick="window.location.href='login.html?redirect=peliculas.html'">Iniciar sesi√≥n</button><br>
                        <button onclick="window.location.href='registro.html'">Registrar</button>
                    `;
                }
                popup.style.display = 'block';
                // Posiciona el popup justo debajo y alineado al √≠cono de usuario
                const icon = socioBtn.querySelector('i');
                const rect = icon.getBoundingClientRect();
                popup.style.top = (rect.bottom + window.scrollY + 8) + 'px';
                popup.style.left = (rect.left + window.scrollX) + 'px';
            });

            // Ocultar popup al hacer click fuera
            document.addEventListener('click', function(e) {
                if (!popup.contains(e.target) && !socioBtn.contains(e.target)) {
                    popup.style.display = 'none';
                }
            });
        </script>
    </body>
</html>